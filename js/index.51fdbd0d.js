(function(){"use strict";var t={4848:function(t,e,n){var o=n(9242),r=n(3396);function a(t,e,n,o,a,i){const s=(0,r.up)("Navbar"),c=(0,r.up)("router-view");return(0,r.wg)(),(0,r.iD)(r.HY,null,[a.pageExist?((0,r.wg)(),(0,r.j4)(s,{key:t.isLogin})):(0,r.kq)("",!0),(0,r.Wm)(c)],64)}var i=n(7139),s=n(1151);const c=t=>((0,r.dD)("data-v-83aa55fe"),t=t(),(0,r.Cn)(),t),u={class:"navbar sticky-top"},l={class:"container-fluid position-relative"},d={class:"d-inline-flex"},p=c((()=>(0,r._)("a",{class:"nav-link",href:"#",title:"找商品"},[(0,r._)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[(0,r._)("path",{d:"M500.3 443.7l-119.7-119.7c27.22-40.41 40.65-90.9 33.46-144.7C401.8 87.79 326.8 13.32 235.2 1.723C99.01-15.51-15.51 99.01 1.724 235.2c11.6 91.64 86.08 166.7 177.6 178.9c53.8 7.189 104.3-6.236 144.7-33.46l119.7 119.7c15.62 15.62 40.95 15.62 56.57 0C515.9 484.7 515.9 459.3 500.3 443.7zM79.1 208c0-70.58 57.42-128 128-128s128 57.42 128 128c0 70.58-57.42 128-128 128S79.1 278.6 79.1 208z"})])],-1))),f=c((()=>(0,r._)("img",{src:s,alt:"kohola-logo"},null,-1))),h={class:"navbar-nav flex-row"},m=c((()=>(0,r._)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[(0,r._)("path",{d:"M224 256c70.7 0 128-57.31 128-128s-57.3-128-128-128C153.3 0 96 57.31 96 128S153.3 256 224 256zM274.7 304H173.3C77.61 304 0 381.6 0 477.3c0 19.14 15.52 34.67 34.66 34.67h378.7C432.5 512 448 496.5 448 477.3C448 381.6 370.4 304 274.7 304z"})],-1))),g={key:1,class:"row"},v={class:"col text-nowrap greetings d-none d-md-block pe-3"},w=c((()=>(0,r._)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},[(0,r._)("path",{d:"M96 480h64C177.7 480 192 465.7 192 448S177.7 416 160 416H96c-17.67 0-32-14.33-32-32V128c0-17.67 14.33-32 32-32h64C177.7 96 192 81.67 192 64S177.7 32 160 32H96C42.98 32 0 74.98 0 128v256C0 437 42.98 480 96 480zM504.8 238.5l-144.1-136c-6.975-6.578-17.2-8.375-26-4.594c-8.803 3.797-14.51 12.47-14.51 22.05l-.0918 72l-128-.001c-17.69 0-32.02 14.33-32.02 32v64c0 17.67 14.34 32 32.02 32l128 .001l.0918 71.1c0 9.578 5.707 18.25 14.51 22.05c8.803 3.781 19.03 1.984 26-4.594l144.1-136C514.4 264.4 514.4 247.6 504.8 238.5z"})],-1))),C=c((()=>(0,r._)("a",{class:"nav-link ps-4",title:"購物袋",href:"#"},[(0,r._)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512"},[(0,r._)("path",{d:"M112 112C112 50.14 162.1 0 224 0C285.9 0 336 50.14 336 112V160H400C426.5 160 448 181.5 448 208V416C448 469 405 512 352 512H96C42.98 512 0 469 0 416V208C0 181.5 21.49 160 48 160H112V112zM160 160H288V112C288 76.65 259.3 48 224 48C188.7 48 160 76.65 160 112V160zM136 256C149.3 256 160 245.3 160 232C160 218.7 149.3 208 136 208C122.7 208 112 218.7 112 232C112 245.3 122.7 256 136 256zM312 208C298.7 208 288 218.7 288 232C288 245.3 298.7 256 312 256C325.3 256 336 245.3 336 232C336 218.7 325.3 208 312 208z"})])],-1)));function b(t,e,n,a,s,c){const b=(0,r.up)("SearchPopper"),y=(0,r.up)("router-link");return(0,r.wg)(),(0,r.iD)("nav",u,[(0,r._)("div",l,[(0,r._)("div",d,[(0,r.Wm)(b,null,{default:(0,r.w5)((()=>[p])),_:1})]),(0,r.Wm)(y,{class:"navbar-brand m-0 position-absolute top-50 start-50 translate-middle",to:"/products"},{default:(0,r.w5)((()=>[f])),_:1}),(0,r._)("div",h,[t.isLogin?((0,r.wg)(),(0,r.iD)("div",g,[(0,r._)("div",v," Hi "+(0,i.zw)(t.userName),1),(0,r.Wm)(y,{class:"nav-link col pe-4",title:"會員登出",to:"/",onClick:(0,o.iM)(c.doLogout,["prevent"])},{default:(0,r.w5)((()=>[w])),_:1},8,["onClick"])])):((0,r.wg)(),(0,r.j4)(y,{key:0,class:"nav-link pe-4",title:"會員登入",to:"/login"},{default:(0,r.w5)((()=>[m])),_:1})),C])])])}var y=n(9749);function _(t,e,n,a,i,s){const c=(0,r.up)("Popper");return(0,r.wg)(),(0,r.j4)(c,{arrow:"",placement:i.placement},{content:(0,r.w5)((()=>[(0,r.wy)((0,r._)("input",{class:"form-control",type:"text",placeholder:"找商品","onUpdate:modelValue":e[0]||(e[0]=t=>i.keywords=t)},null,512),[[o.nr,i.keywords]])])),default:(0,r.w5)((()=>[(0,r.WI)(t.$slots,"default")])),_:3},8,["placement"])}var k=n(3758),L={components:{Popper:k.Z},data(){return{placement:"bottom",keywords:""}},mounted(){window.onresize=()=>{window.innerWidth<768?this.placement="bottom":this.placement="right"}}},x=n(89);const S=(0,x.Z)(L,[["render",_]]);var j=S,T={components:{SearchPopper:j},computed:{...(0,y.rn)(["isLogin","userName"])},methods:{doLogout(){this.$axios.get("/api/users/logout").then((()=>{this.$store.dispatch("setLogout"),this.$router.push({name:"products"})}))}}};const N=(0,x.Z)(T,[["render",b],["__scopeId","data-v-83aa55fe"]]);var O=N,M={components:{Navbar:O},data(){return{pageExist:!0,...(0,y.rn)(["isLogin"])}},watch:{$route:{immediate:!0,handler(){"404"===this.$route.name&&(this.pageExist=!1)}}},mounted(){this.$store.dispatch("checkAuthentication")}};const P=(0,x.Z)(M,[["render",a]]);var A=P,E=n(678);const z=[{path:"/",name:"home",redirect:"/products"},{path:"/products",name:"products",component:()=>n.e(341).then(n.bind(n,6341))},{path:"/products/:productId",name:"product",component:()=>n.e(629).then(n.bind(n,3629))},{path:"/login",name:"login",component:()=>n.e(40).then(n.bind(n,3040))},{path:"/404",name:"404",component:()=>n.e(592).then(n.bind(n,1592))},{path:"/:catchAll(.*)",redirect:"/404"}],B=(0,E.p7)({history:(0,E.PO)("/final_project_shopping_cart/"),routes:z});var D=B,H=n(2415),V=t=>(0,y.MT)({state:{userCart:[],userName:"",isLogin:!1},mutations:{setLoginState(t,e){t.isLogin=!0,t.userName=e},setLogoutState(t){t.isLogin=!1,t.userName=""},clearCart(t){t.userCart=[]},adjustCartAmount(t,e){t.userCart=e.filter((t=>t))},addToCart(t,e){const n=t.userCart.find((t=>t.product_id===e[0]));if(n)n.amount+=e[1];else{const n={product_id:e[0],amount:e[1]};t.userCart.push(n)}}},actions:{addToCart({state:t,dispatch:e,commit:n},o){n("addToCart",o),t.isLogin&&e("storeCartToDB")},checkAuthentication({state:e,commit:n}){t.get("/auth").then((t=>{"authenticated"===t.data?n("setLoginState",e.userName):n("setLogoutState")}))},async setLogin({commit:t,dispatch:e},n){t("setLoginState",n),await e("pullCartFromDB"),await e("checkProductQuantity"),await e("storeCartToDB")},setLogout({commit:t}){t("setLogoutState"),t("clearCart")},async storeCartToDB({state:e}){try{await t.post("/api/cart",{cart:e.userCart})}catch(n){console.log(n)}},async pullCartFromDB({dispatch:e}){try{const n=await t.get("/api/cart");n.data.data.map((({product_id:t,amount:n})=>{e("addToCart",[t,n])}))}catch(n){console.log(n)}},async checkProductQuantity({state:e,commit:n}){try{const o=await t.get("/api/products"),r=e.userCart.map((t=>{const e=o.data.find((e=>e.id===t.product_id));return e?(e.quantity<t.amount&&(t.amount=e.quantity),t):null}));n("adjustCartAmount",r)}catch(o){console.log(o)}}},modules:{},plugins:[(0,H.Z)({paths:["userCart","userName"]})]}),$=(n(8937),n(6553)),F=n.n($),W=n(6265),q=n.n(W);const Z=(0,o.ri)(A);q().defaults.baseURL="https://shopping-cart-bn-test.herokuapp.com",q().defaults.withCredentials=!0,q().defaults.headers.post["Content-Type"]="application/json",Z.config.globalProperties.$axios=q(),Z.use(D).use(V(q())).use(F()).mount("#app")},1151:function(t,e,n){t.exports=n.p+"img/shop-logo.2bcafe9c.svg"}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}n.m=t,function(){var t=[];n.O=function(e,o,r,a){if(!o){var i=1/0;for(l=0;l<t.length;l++){o=t[l][0],r=t[l][1],a=t[l][2];for(var s=!0,c=0;c<o.length;c++)(!1&a||i>=a)&&Object.keys(n.O).every((function(t){return n.O[t](o[c])}))?o.splice(c--,1):(s=!1,a<i&&(i=a));if(s){t.splice(l--,1);var u=r();void 0!==u&&(e=u)}}return e}a=a||0;for(var l=t.length;l>0&&t[l-1][2]>a;l--)t[l]=t[l-1];t[l]=[o,r,a]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})}}(),function(){n.f={},n.e=function(t){return Promise.all(Object.keys(n.f).reduce((function(e,o){return n.f[o](t,e),e}),[]))}}(),function(){n.u=function(t){return"js/"+t+"."+{40:"2792bac6",341:"6b557044",592:"0c5e26e4",629:"42bb93db"}[t]+".js"}}(),function(){n.miniCssF=function(t){return"css/"+t+"."+{40:"74e1f9e4",341:"393032c2",629:"b17376a3"}[t]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="shopping_cart:";n.l=function(o,r,a,i){if(t[o])t[o].push(r);else{var s,c;if(void 0!==a)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==o||d.getAttribute("data-webpack")==e+a){s=d;break}}s||(c=!0,s=document.createElement("script"),s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.setAttribute("data-webpack",e+a),s.src=o),t[o]=[r];var p=function(e,n){s.onerror=s.onload=null,clearTimeout(f);var r=t[o];if(delete t[o],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((function(t){return t(n)})),e)return e(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=p.bind(null,s.onerror),s.onload=p.bind(null,s.onload),c&&document.head.appendChild(s)}}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p="/final_project_shopping_cart/"}(),function(){var t=function(t,e,n,o){var r=document.createElement("link");r.rel="stylesheet",r.type="text/css";var a=function(a){if(r.onerror=r.onload=null,"load"===a.type)n();else{var i=a&&("load"===a.type?"missing":a.type),s=a&&a.target&&a.target.href||e,c=new Error("Loading CSS chunk "+t+" failed.\n("+s+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=i,c.request=s,r.parentNode.removeChild(r),o(c)}};return r.onerror=r.onload=a,r.href=e,document.head.appendChild(r),r},e=function(t,e){for(var n=document.getElementsByTagName("link"),o=0;o<n.length;o++){var r=n[o],a=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(a===t||a===e))return r}var i=document.getElementsByTagName("style");for(o=0;o<i.length;o++){r=i[o],a=r.getAttribute("data-href");if(a===t||a===e)return r}},o=function(o){return new Promise((function(r,a){var i=n.miniCssF(o),s=n.p+i;if(e(i,s))return r();t(o,s,r,a)}))},r={826:0};n.f.miniCss=function(t,e){var n={40:1,341:1,629:1};r[t]?e.push(r[t]):0!==r[t]&&n[t]&&e.push(r[t]=o(t).then((function(){r[t]=0}),(function(e){throw delete r[t],e})))}}(),function(){var t={826:0};n.f.j=function(e,o){var r=n.o(t,e)?t[e]:void 0;if(0!==r)if(r)o.push(r[2]);else{var a=new Promise((function(n,o){r=t[e]=[n,o]}));o.push(r[2]=a);var i=n.p+n.u(e),s=new Error,c=function(o){if(n.o(t,e)&&(r=t[e],0!==r&&(t[e]=void 0),r)){var a=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;s.message="Loading chunk "+e+" failed.\n("+a+": "+i+")",s.name="ChunkLoadError",s.type=a,s.request=i,r[1](s)}};n.l(i,c,"chunk-"+e,e)}},n.O.j=function(e){return 0===t[e]};var e=function(e,o){var r,a,i=o[0],s=o[1],c=o[2],u=0;if(i.some((function(e){return 0!==t[e]}))){for(r in s)n.o(s,r)&&(n.m[r]=s[r]);if(c)var l=c(n)}for(e&&e(o);u<i.length;u++)a=i[u],n.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return n.O(l)},o=self["webpackChunkshopping_cart"]=self["webpackChunkshopping_cart"]||[];o.forEach(e.bind(null,0)),o.push=e.bind(null,o.push.bind(o))}();var o=n.O(void 0,[998],(function(){return n(4848)}));o=n.O(o)})();